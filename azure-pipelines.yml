trigger:
- main

pool:
  vmImage: ubuntu-latest

variables:
  namespace: hello
  yamlPath: hello-deployment.yaml

steps:
# 1. kubeconfig.yaml Secure File 다운로드
- task: DownloadSecureFile@1
  name: kubeconfig
  inputs:
    secureFile: 'kubeconfig.yaml'   # 🔐 Secure Files에 업로드한 파일 이름

# 2. kubectl apply 실행
- script: |
    echo ">> Setting KUBECONFIG"
    export KUBECONFIG=$(kubeconfig.secureFilePath)

    echo ">> Create namespace if not exists"
    kubectl create namespace $namespace --dry-run=client -o yaml | kubectl apply -f -

    echo ">> Apply YAML to Arc-enabled AKS"
    kubectl apply -f $yamlPath -n $namespace
  displayName: 'Deploy to Azure Arc AKS'
