trigger:
- main

pool:
  vmImage: ubuntu-latest

variables:
  namespace: hello
  yamlPath: hello-deployment.yaml

steps:
# 1. kubeconfig.yaml Secure File ë‹¤ìš´ë¡œë“œ
- task: DownloadSecureFile@1
  name: kubeconfig
  inputs:
    secureFile: 'kubeconfig.yaml'   # ðŸ” Secure Filesì— ì—…ë¡œë“œí•œ íŒŒì¼ ì´ë¦„

# 2. kubectl apply ì‹¤í–‰
- script: |
    echo ">> Setting KUBECONFIG"
    export KUBECONFIG=$(kubeconfig.secureFilePath)

    echo ">> Create namespace if not exists"
    kubectl create namespace $namespace --dry-run=client -o yaml | kubectl apply -f -

    echo ">> Apply YAML to Arc-enabled AKS"
    kubectl apply -f $yamlPath -n $namespace
  displayName: 'Deploy to Azure Arc AKS'
